{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar exponential_backoff_with_jitter_1 = __importDefault(require(\"./exponential_backoff_with_jitter\"));\n\nvar object_to_query_param_string_1 = __importDefault(require(\"./object_to_query_param_string\"));\n\nvar package_version_1 = __importDefault(require(\"./package_version\"));\n\nvar fetch_1 = __importDefault(require(\"./fetch\"));\n\nvar abort_controller_1 = __importDefault(require(\"./abort-controller\"));\n\nvar userAgent = \"Airtable.js/\" + package_version_1.default;\n\nfunction runAction(base, method, path, queryParams, bodyData, callback, numAttempts) {\n  var url = base._airtable._endpointUrl + \"/v\" + base._airtable._apiVersionMajor + \"/\" + base._id + path + \"?\" + object_to_query_param_string_1.default(queryParams);\n  var headers = {\n    authorization: \"Bearer \" + base._airtable._apiKey,\n    'x-api-version': base._airtable._apiVersion,\n    'x-airtable-application-id': base.getId(),\n    'content-type': 'application/json'\n  };\n  var isBrowser = typeof window !== 'undefined'; // Some browsers do not allow overriding the user agent.\n  // https://github.com/Airtable/airtable.js/issues/52\n\n  if (isBrowser) {\n    headers['x-airtable-user-agent'] = userAgent;\n  } else {\n    headers['User-Agent'] = userAgent;\n  }\n\n  var controller = new abort_controller_1.default();\n  var normalizedMethod = method.toUpperCase();\n  var options = {\n    method: normalizedMethod,\n    headers: headers,\n    signal: controller.signal\n  };\n\n  if (bodyData !== null) {\n    if (normalizedMethod === 'GET' || normalizedMethod === 'HEAD') {\n      console.warn('body argument to runAction are ignored with GET or HEAD requests');\n    } else {\n      options.body = JSON.stringify(bodyData);\n    }\n  }\n\n  var timeout = setTimeout(function () {\n    controller.abort();\n  }, base._airtable._requestTimeout);\n  fetch_1.default(url, options).then(function (resp) {\n    clearTimeout(timeout);\n\n    if (resp.status === 429 && !base._airtable._noRetryIfRateLimited) {\n      var backoffDelayMs = exponential_backoff_with_jitter_1.default(numAttempts);\n      setTimeout(function () {\n        runAction(base, method, path, queryParams, bodyData, callback, numAttempts + 1);\n      }, backoffDelayMs);\n    } else {\n      resp.json().then(function (body) {\n        var error = base._checkStatusForError(resp.status, body); // Ensure Response interface matches interface from\n        // `request` Response object\n\n\n        var r = {};\n        Object.keys(resp).forEach(function (property) {\n          r[property] = resp[property];\n        });\n        r.body = body;\n        r.statusCode = resp.status;\n        callback(error, r, body);\n      }).catch(function () {\n        callback(base._checkStatusForError(resp.status));\n      });\n    }\n  }).catch(function (error) {\n    clearTimeout(timeout);\n    callback(error);\n  });\n}\n\nmodule.exports = runAction;","map":{"version":3,"mappings":"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","names":["userAgent","package_version_1","runAction","base","method","path","queryParams","bodyData","callback","numAttempts","url","_airtable","_endpointUrl","_apiVersionMajor","_id","object_to_query_param_string_1","headers","authorization","_apiKey","_apiVersion","getId","isBrowser","window","controller","abort_controller_1","normalizedMethod","toUpperCase","options","signal","console","warn","body","JSON","stringify","timeout","setTimeout","abort","_requestTimeout","fetch_1","then","clearTimeout","resp","status","_noRetryIfRateLimited","backoffDelayMs","exponential_backoff_with_jitter_1","json","error","_checkStatusForError","r","Object","keys","forEach","property","statusCode","catch","module"],"sources":["../src/run_action.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}
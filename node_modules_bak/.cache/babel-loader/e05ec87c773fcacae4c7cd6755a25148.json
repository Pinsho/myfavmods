{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar get_1 = __importDefault(require(\"lodash/get\"));\n\nvar isPlainObject_1 = __importDefault(require(\"lodash/isPlainObject\"));\n\nvar keys_1 = __importDefault(require(\"lodash/keys\"));\n\nvar fetch_1 = __importDefault(require(\"./fetch\"));\n\nvar abort_controller_1 = __importDefault(require(\"./abort-controller\"));\n\nvar object_to_query_param_string_1 = __importDefault(require(\"./object_to_query_param_string\"));\n\nvar airtable_error_1 = __importDefault(require(\"./airtable_error\"));\n\nvar table_1 = __importDefault(require(\"./table\"));\n\nvar http_headers_1 = __importDefault(require(\"./http_headers\"));\n\nvar run_action_1 = __importDefault(require(\"./run_action\"));\n\nvar package_version_1 = __importDefault(require(\"./package_version\"));\n\nvar exponential_backoff_with_jitter_1 = __importDefault(require(\"./exponential_backoff_with_jitter\"));\n\nvar userAgent = \"Airtable.js/\" + package_version_1.default;\n\nvar Base =\n/** @class */\nfunction () {\n  function Base(airtable, baseId) {\n    this._airtable = airtable;\n    this._id = baseId;\n  }\n\n  Base.prototype.table = function (tableName) {\n    return new table_1.default(this, null, tableName);\n  };\n\n  Base.prototype.makeRequest = function (options) {\n    var _this = this;\n\n    var _a;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    var method = get_1.default(options, 'method', 'GET').toUpperCase();\n    var url = this._airtable._endpointUrl + \"/v\" + this._airtable._apiVersionMajor + \"/\" + this._id + get_1.default(options, 'path', '/') + \"?\" + object_to_query_param_string_1.default(get_1.default(options, 'qs', {}));\n    var controller = new abort_controller_1.default();\n\n    var headers = this._getRequestHeaders(Object.assign({}, this._airtable._customHeaders, (_a = options.headers) !== null && _a !== void 0 ? _a : {}));\n\n    var requestOptions = {\n      method: method,\n      headers: headers,\n      signal: controller.signal\n    };\n\n    if ('body' in options && _canRequestMethodIncludeBody(method)) {\n      requestOptions.body = JSON.stringify(options.body);\n    }\n\n    var timeout = setTimeout(function () {\n      controller.abort();\n    }, this._airtable._requestTimeout);\n    return new Promise(function (resolve, reject) {\n      fetch_1.default(url, requestOptions).then(function (resp) {\n        clearTimeout(timeout);\n\n        if (resp.status === 429 && !_this._airtable._noRetryIfRateLimited) {\n          var numAttempts_1 = get_1.default(options, '_numAttempts', 0);\n          var backoffDelayMs = exponential_backoff_with_jitter_1.default(numAttempts_1);\n          setTimeout(function () {\n            var newOptions = __assign(__assign({}, options), {\n              _numAttempts: numAttempts_1 + 1\n            });\n\n            _this.makeRequest(newOptions).then(resolve).catch(reject);\n          }, backoffDelayMs);\n        } else {\n          resp.json().then(function (body) {\n            var err = _this._checkStatusForError(resp.status, body) || _getErrorForNonObjectBody(resp.status, body);\n\n            if (err) {\n              reject(err);\n            } else {\n              resolve({\n                statusCode: resp.status,\n                headers: resp.headers,\n                body: body\n              });\n            }\n          }).catch(function () {\n            var err = _getErrorForNonObjectBody(resp.status);\n\n            reject(err);\n          });\n        }\n      }).catch(function (err) {\n        clearTimeout(timeout);\n        err = new airtable_error_1.default('CONNECTION_ERROR', err.message, null);\n        reject(err);\n      });\n    });\n  };\n  /**\n   * @deprecated This method is deprecated.\n   */\n\n\n  Base.prototype.runAction = function (method, path, queryParams, bodyData, callback) {\n    run_action_1.default(this, method, path, queryParams, bodyData, callback, 0);\n  };\n\n  Base.prototype._getRequestHeaders = function (headers) {\n    var result = new http_headers_1.default();\n    result.set('Authorization', \"Bearer \" + this._airtable._apiKey);\n    result.set('User-Agent', userAgent);\n    result.set('Content-Type', 'application/json');\n\n    for (var _i = 0, _a = keys_1.default(headers); _i < _a.length; _i++) {\n      var headerKey = _a[_i];\n      result.set(headerKey, headers[headerKey]);\n    }\n\n    return result.toJSON();\n  };\n\n  Base.prototype._checkStatusForError = function (statusCode, body) {\n    var _a = (body !== null && body !== void 0 ? body : {\n      error: {}\n    }).error,\n        error = _a === void 0 ? {} : _a;\n    var type = error.type,\n        message = error.message;\n\n    if (statusCode === 401) {\n      return new airtable_error_1.default('AUTHENTICATION_REQUIRED', 'You should provide valid api key to perform this operation', statusCode);\n    } else if (statusCode === 403) {\n      return new airtable_error_1.default('NOT_AUTHORIZED', 'You are not authorized to perform this operation', statusCode);\n    } else if (statusCode === 404) {\n      return new airtable_error_1.default('NOT_FOUND', message !== null && message !== void 0 ? message : 'Could not find what you are looking for', statusCode);\n    } else if (statusCode === 413) {\n      return new airtable_error_1.default('REQUEST_TOO_LARGE', 'Request body is too large', statusCode);\n    } else if (statusCode === 422) {\n      return new airtable_error_1.default(type !== null && type !== void 0 ? type : 'UNPROCESSABLE_ENTITY', message !== null && message !== void 0 ? message : 'The operation cannot be processed', statusCode);\n    } else if (statusCode === 429) {\n      return new airtable_error_1.default('TOO_MANY_REQUESTS', 'You have made too many requests in a short period of time. Please retry your request later', statusCode);\n    } else if (statusCode === 500) {\n      return new airtable_error_1.default('SERVER_ERROR', 'Try again. If the problem persists, contact support.', statusCode);\n    } else if (statusCode === 503) {\n      return new airtable_error_1.default('SERVICE_UNAVAILABLE', 'The service is temporarily unavailable. Please retry shortly.', statusCode);\n    } else if (statusCode >= 400) {\n      return new airtable_error_1.default(type !== null && type !== void 0 ? type : 'UNEXPECTED_ERROR', message !== null && message !== void 0 ? message : 'An unexpected error occurred', statusCode);\n    } else {\n      return null;\n    }\n  };\n\n  Base.prototype.doCall = function (tableName) {\n    return this.table(tableName);\n  };\n\n  Base.prototype.getId = function () {\n    return this._id;\n  };\n\n  Base.createFunctor = function (airtable, baseId) {\n    var base = new Base(airtable, baseId);\n\n    var baseFn = function baseFn(tableName) {\n      return base.doCall(tableName);\n    };\n\n    baseFn._base = base;\n    baseFn.table = base.table.bind(base);\n    baseFn.makeRequest = base.makeRequest.bind(base);\n    baseFn.runAction = base.runAction.bind(base);\n    baseFn.getId = base.getId.bind(base);\n    return baseFn;\n  };\n\n  return Base;\n}();\n\nfunction _canRequestMethodIncludeBody(method) {\n  return method !== 'GET' && method !== 'DELETE';\n}\n\nfunction _getErrorForNonObjectBody(statusCode, body) {\n  if (isPlainObject_1.default(body)) {\n    return null;\n  } else {\n    return new airtable_error_1.default('UNEXPECTED_ERROR', 'The response from Airtable was invalid JSON. Please try again soon.', statusCode);\n  }\n}\n\nmodule.exports = Base;","map":{"version":3,"mappings":"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","names":["userAgent","package_version_1","airtable","baseId","_airtable","_id","Base","tableName","table_1","options","method","get_1","toUpperCase","url","_endpointUrl","_apiVersionMajor","object_to_query_param_string_1","controller","abort_controller_1","headers","_getRequestHeaders","Object","assign","_customHeaders","_a","requestOptions","signal","_canRequestMethodIncludeBody","body","JSON","stringify","timeout","setTimeout","abort","_requestTimeout","Promise","resolve","reject","fetch_1","then","resp","clearTimeout","status","_this","_noRetryIfRateLimited","numAttempts_1","backoffDelayMs","exponential_backoff_with_jitter_1","newOptions","_numAttempts","makeRequest","catch","json","err","_checkStatusForError","_getErrorForNonObjectBody","statusCode","airtable_error_1","message","path","queryParams","bodyData","callback","run_action_1","result","http_headers_1","set","_apiKey","_i","headerKey","toJSON","error","type","table","base","baseFn","doCall","_base","bind","runAction","getId","isPlainObject_1","module"],"sources":["../src/base.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}